{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://artificery.io/schemas/ddb/spell.schema.json",
  "title": "D&D Beyond Spell",
  "description": "Schema for spell data extracted from D&D Beyond",
  "type": "object",
  "required": ["spell"],
  "properties": {
    "spell": {
      "type": "object",
      "description": "Spell data",
      "required": ["meta", "name"],
      "properties": {
        "meta": {
          "type": "object",
          "description": "Metadata about the extraction",
          "required": ["url", "timestamp", "sourceVersion"],
          "properties": {
            "url": {
              "type": "string",
              "description": "URL of the D&D Beyond spell page (may be empty string)"
            },
            "timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "ISO 8601 timestamp of when the data was extracted"
            },
            "sourceVersion": {
              "type": "string",
              "pattern": "^\\d+\\.\\d+\\.\\d+$",
              "description": "Version of the extraction source (semver)"
            },
            "edition": {
              "type": ["string", "null"],
              "enum": ["2014", "2024", null],
              "description": "D&D edition detected from page format"
            },
            "tags": {
              "type": "array",
              "description": "Spell tags (damage type, control, utility, etc.)",
              "items": {
                "type": "string"
              }
            },
            "source": {
              "type": ["string", "null"],
              "description": "Source book name (e.g., 'SRD 5.1', 'SRD 5.2.1')"
            },
            "classes": {
              "type": "array",
              "description": "Classes that can cast this spell",
              "items": {
                "type": "string",
                "description": "Class name (e.g., 'Wizard', 'Cleric')"
              }
            }
          }
        },
        "name": {
          "type": "string",
          "description": "Name of the spell"
        },
        "level": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 9,
          "description": "Spell level as number (0 for cantrip, 1-9 for spell levels)"
        },
        "school": {
          "type": ["string", "null"],
          "enum": [
            "abjuration",
            "conjuration",
            "divination",
            "enchantment",
            "evocation",
            "illusion",
            "necromancy",
            "transmutation",
            null
          ],
          "description": "School of magic (normalized to lowercase)"
        },
        "castingTime": {
          "type": ["object", "null"],
          "description": "Casting time information",
          "properties": {
            "value": {
              "type": ["string", "null"],
              "description": "Casting time (e.g., '1 action', '1 bonus action', '1 reaction')"
            },
            "trigger": {
              "type": ["string", "null"],
              "description": "Reaction trigger (if applicable)"
            }
          }
        },
        "range": {
          "type": ["string", "null"],
          "description": "Range/area (e.g., '60 feet', 'Self (15-foot cone)')"
        },
        "components": {
          "type": ["object", "null"],
          "description": "Spell components required",
          "properties": {
            "verbal": {
              "type": "boolean",
              "description": "Requires verbal component"
            },
            "somatic": {
              "type": "boolean",
              "description": "Requires somatic component"
            },
            "material": {
              "type": ["string", "null"],
              "description": "Material components required (null if none)"
            }
          }
        },
        "duration": {
          "type": ["string", "null"],
          "description": "Duration (e.g., 'Instantaneous', 'Concentration, up to 1 minute')"
        },
        "description": {
          "type": "string",
          "description": "Spell description in markdown format"
        },
        "concentration": {
          "type": ["boolean", "null"],
          "description": "Whether the spell requires concentration"
        },
        "ritual": {
          "type": ["boolean", "null"],
          "description": "Whether the spell can be cast as a ritual"
        },
        "attack": {
          "type": ["string", "null"],
          "description": "Attack type if applicable (e.g., 'Melee', 'Ranged')"
        },
        "save": {
          "type": ["string", "null"],
          "description": "Saving throw required if applicable (e.g., 'Dexterity', 'Wisdom')"
        },
        "damageType": {
          "type": ["array", "null"],
          "description": "Damage types or condition effects",
          "items": {
            "type": "string"
          }
        },
        "higherLevels": {
          "type": ["string", "null"],
          "description": "Description of effects when cast at higher levels (markdown)"
        }
      }
    }
  }
}
